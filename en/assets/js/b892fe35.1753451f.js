"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[18098],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>k});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),c=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},s=function(e){var t=c(e.components);return a.createElement(p.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,p=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),d=c(n),u=r,k=d["".concat(p,".").concat(u)]||d[u]||m[u]||l;return n?a.createElement(k,i(i({ref:t},s),{},{components:n})):a.createElement(k,i({ref:t},s))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=u;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[d]="string"==typeof e?e:r,i[1]=o;for(var c=2;c<l;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},74484:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>o,toc:()=>c});var a=n(87462),r=(n(67294),n(3905));const l={},i="Built-in service",o={unversionedId:"built_in_service",id:"built_in_service",title:"Built-in service",description:"In Midway, many built-in objects are provided for the convenience of users.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/built_in_service.md",sourceDirName:".",slug:"/built_in_service",permalink:"/en/docs/built_in_service",draft:!1,editUrl:"https://github.com/midwayjs/midway/tree/main/site/docs/built_in_service.md",tags:[],version:"current",frontMatter:{},sidebar:"common",previous:{title:"Cookies and Session",permalink:"/en/docs/cookie_session"},next:{title:"Router Table",permalink:"/en/docs/router_table"}},p={},c=[{value:"MidwayApplicationManager",id:"midwayapplicationmanager",level:2},{value:"MidwayInformationService",id:"midwayinformationservice",level:2},{value:"MidwayEnvironmentService",id:"midwayenvironmentservice",level:2},{value:"MidwayConfigService",id:"midwayconfigservice",level:2},{value:"MidwayLoggerService",id:"midwayloggerservice",level:2},{value:"MidwayFrameworkService",id:"midwayframeworkservice",level:2},{value:"MidwayMiddlewareService",id:"midwaymiddlewareservice",level:2},{value:"MidwayDecoratorService",id:"midwaydecoratorservice",level:2},{value:"MidwayAspectService",id:"midwayaspectservice",level:2},{value:"MidwayLifeCycleService",id:"midwaylifecycleservice",level:2},{value:"MidwayMockService",id:"midwaymockservice",level:2},{value:"mockClassProperty",id:"mockclassproperty",level:3},{value:"mockProperty",id:"mockproperty",level:3},{value:"mockContext",id:"mockcontext",level:3},{value:"MidwayWebRouterService",id:"midwaywebrouterservice",level:2},{value:"MidwayServerlessFunctionService",id:"midwayserverlessfunctionservice",level:2},{value:"MidwayHealthService",id:"midwayhealthservice",level:2}],s={toc:c},d="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(d,(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"built-in-service"},"Built-in service"),(0,r.kt)("p",null,"In Midway, many built-in objects are provided for the convenience of users."),(0,r.kt)("p",null,"In this section, we will introduce the Application associated with the framework, Context objects, and some service objects on Midway default containers, which are often encountered in the entire business development."),(0,r.kt)("p",null,"The following are some services built into the Midway dependency injection container. These services are initialized by the dependency injection container and are globally available in the business."),(0,r.kt)("h2",{id:"midwayapplicationmanager"},"MidwayApplicationManager"),(0,r.kt)("p",null,"Midway's built-in application manager can be used to get all the Application."),(0,r.kt)("p",null,"It can be obtained by injection, such as adding the same middleware to different applications."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { MidwayApplicationManager, Configuration, Inject } from '@midwayjs/core';\nimport { CustomMiddleware } from './middleware/custom.middleware';\n\n@Configuration({\n  // ...\n})\nexport class MainConfiguration {\n  @Inject()\n  applicationManager: MidwayApplicationManager;\n\n  async onReady() {\n    this.applicationManager\n      .getApplications(['koa', 'faas', 'express', 'egg'])\n      .forEach(app => {\n        app.useMiddleware(CustomMiddleware);\n      });\n  }\n}\n")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"API"),(0,r.kt)("th",{parentName:"tr",align:null},"return type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"getFramework(namespace: string)"),(0,r.kt)("td",{parentName:"tr",align:null},"IMidwayFramework"),(0,r.kt)("td",{parentName:"tr",align:null},"Returns the framework specified by the parameter")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"getApplication(namespace: string)"),(0,r.kt)("td",{parentName:"tr",align:null},"IMidwayApplication"),(0,r.kt)("td",{parentName:"tr",align:null},"Returns the Application specified by the parameter")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"getApplications(namespace: string[])"),(0,r.kt)("td",{parentName:"tr",align:null},"IMidwayApplication[]"),(0,r.kt)("td",{parentName:"tr",align:null},"Returns multiple Application specified by the parameter")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"getWebLikeApplication()"),(0,r.kt)("td",{parentName:"tr",align:null},"IMidwayApplication []"),(0,r.kt)("td",{parentName:"tr",align:null},"Returns Application similar to Web scenarios (express/koa/egg/faas)")))),(0,r.kt)("h2",{id:"midwayinformationservice"},"MidwayInformationService"),(0,r.kt)("p",null,"Midway's built-in information service provides basic project data."),(0,r.kt)("p",null,"It can be obtained by injection."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { MidwayInformationService, Inject, Controller, Get } from '@midwayjs/core';\n\n@Controller('/')\nexport class HomeController {\n\n  @Inject()\n  informationService: MidwayInformationService;\n\n  @Get('/')\n  async home() {\n    // this.informationService.getAppDir();\n  }\n}\n")),(0,r.kt)("p",null,"Generally used to return user-related directories."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"API"),(0,r.kt)("th",{parentName:"tr",align:null},"Return type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"getAppDir()"),(0,r.kt)("td",{parentName:"tr",align:null},"String"),(0,r.kt)("td",{parentName:"tr",align:null},"Return to the application root directory")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"getBaseDir()"),(0,r.kt)("td",{parentName:"tr",align:null},"String"),(0,r.kt)("td",{parentName:"tr",align:null},"Returns the application code directory. By default, the local development is src and the server running is dist.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"getHome"),(0,r.kt)("td",{parentName:"tr",align:null},"String"),(0,r.kt)("td",{parentName:"tr",align:null},"Return to the machine user directory, which refers to the address.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"getPkg"),(0,r.kt)("td",{parentName:"tr",align:null},"Object"),(0,r.kt)("td",{parentName:"tr",align:null},"Returns the contents of the package.json")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"getRoot"),(0,r.kt)("td",{parentName:"tr",align:null},"String"),(0,r.kt)("td",{parentName:"tr",align:null},"In the development environment, return to appDir, and in other environments, return to the Home directory.")))),(0,r.kt)("h2",{id:"midwayenvironmentservice"},"MidwayEnvironmentService"),(0,r.kt)("p",null,"Midway's built-in environmental services provide environmental settings and judgments."),(0,r.kt)("p",null,"It can be obtained by injection."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { MidwayEnvironmentService, Inject, Controller, Get } from '@midwayjs/core';\n\n@Controller('/')\nexport class HomeController {\n\n  @Inject()\n  environmentService: MidwayEnvironmentService;\n\n  @Get('/')\n  async home() {\n    // this.environmentService.getCurrentEnvironment();\n  }\n}\n")),(0,r.kt)("p",null,"Generally used to obtain the current environment, the API is as follows:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"API"),(0,r.kt)("th",{parentName:"tr",align:null},"Return type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"getCurrentEnvironment()"),(0,r.kt)("td",{parentName:"tr",align:null},"String"),(0,r.kt)("td",{parentName:"tr",align:null},"Return to Apply Current Environment")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"setCurrentEnvironment()"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"Set current environment")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"isDevelopmentEnvironment"),(0,r.kt)("td",{parentName:"tr",align:null},"Boolean"),(0,r.kt)("td",{parentName:"tr",align:null},"Judging whether it is a development environment")))),(0,r.kt)("h2",{id:"midwayconfigservice"},"MidwayConfigService"),(0,r.kt)("p",null,"Midway's built-in multi-environment configuration service provides the loading and obtaining of configurations. It is also the data source of the ",(0,r.kt)("inlineCode",{parentName:"p"},"@Config")," decorator."),(0,r.kt)("p",null,"It can be obtained by injection."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { MidwayConfigService, Inject, Controller, Get } from '@midwayjs/core';\n\n@Controller('/')\nexport class HomeController {\n\n  @Inject()\n  configService: MidwayConfigService;\n\n  @Get('/')\n  async home() {\n    // this.configService.getConfiguration();\n  }\n}\n")),(0,r.kt)("p",null,"Generally used to obtain the current configuration, the API is as follows:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"API"),(0,r.kt)("th",{parentName:"tr",align:null},"Return type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"addObject(obj)"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"Dynamically add configuration objects")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"getConfiguration()"),(0,r.kt)("td",{parentName:"tr",align:null},"Object"),(0,r.kt)("td",{parentName:"tr",align:null},"Returns the currently merged configuration object")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"clearAllConfig()"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"Clear all configurations")))),(0,r.kt)("h2",{id:"midwayloggerservice"},"MidwayLoggerService"),(0,r.kt)("p",null,"The built-in log service of Midway provides API operations such as log creation and retrieval. It is also the data source of the ",(0,r.kt)("inlineCode",{parentName:"p"},"@Logger")," decorator."),(0,r.kt)("p",null,"It can be obtained by injection."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { MidwayLoggerService, Inject, Controller, Get } from '@midwayjs/core';\n\n@Controller('/')\nexport class HomeController {\n\n  @Inject()\n  loggerService: MidwayLoggerService;\n\n  @Get('/')\n  async home() {\n    // this.loggerService.getLogger('logger');\n  }\n}\n")),(0,r.kt)("p",null,"Generally, it is used to obtain log objects. The API is as follows:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"API"),(0,r.kt)("th",{parentName:"tr",align:null},"Return type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"createInstance(name, config)"),(0,r.kt)("td",{parentName:"tr",align:null},"ILogger"),(0,r.kt)("td",{parentName:"tr",align:null},"Dynamically create a Logger instance")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"getLogger(name)"),(0,r.kt)("td",{parentName:"tr",align:null},"ILogger"),(0,r.kt)("td",{parentName:"tr",align:null},"Returns a Logger instance based on the log name.")))),(0,r.kt)("h2",{id:"midwayframeworkservice"},"MidwayFrameworkService"),(0,r.kt)("p",null,"Midway's built-in custom framework service, combined with the custom ",(0,r.kt)("inlineCode",{parentName:"p"},"@Framework")," marked Class in the component, provides external services of different protocols."),(0,r.kt)("p",null,"It can be obtained by injection."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { MidwayFrameworkService, Inject, Controller, Get } from '@midwayjs/core';\n\n@Controller('/')\nexport class HomeController {\n\n  @Inject()\n  frameworkService: MidwayFrameworkService;\n\n  @Get('/')\n  async home() {\n    // this.frameworkService.getMainFramework();\n  }\n}\n")),(0,r.kt)("p",null,"Generally used to obtain Framework objects, the API is as follows:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"API"),(0,r.kt)("th",{parentName:"tr",align:null},"return type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"getMainFramework()"),(0,r.kt)("td",{parentName:"tr",align:null},"IMidwayFramework"),(0,r.kt)("td",{parentName:"tr",align:null},"Returns the main frame instance")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"getMainApp()"),(0,r.kt)("td",{parentName:"tr",align:null},"IMidwayApplication"),(0,r.kt)("td",{parentName:"tr",align:null},"Returns the app object in the main frame")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"getFramework(nameOrFrameworkType)"),(0,r.kt)("td",{parentName:"tr",align:null},"IMidwayFramework"),(0,r.kt)("td",{parentName:"tr",align:null},"Returns a frame instance based on the frame name or frame type")))),(0,r.kt)("h2",{id:"midwaymiddlewareservice"},"MidwayMiddlewareService"),(0,r.kt)("p",null,"Midway's built-in middleware processing service is used for the processing of self-built middleware."),(0,r.kt)("p",null,"Midway's built-in custom decorator service is used to implement frame-level custom decorators, which are generally used when customizing frames."),(0,r.kt)("p",null,"It can be obtained by injection."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { MidwayMiddlewareService, Inject, Controller, Get } from '@midwayjs/core';\n\n@Controller('/')\nexport class HomeController {\n\n  @Inject()\n  middlewareService: MidwayMiddlewareService;\n\n  @Get('/')\n  async home() {\n    // this.middlewareService.com pose(/**omitted**/);\n  }\n}\n")),(0,r.kt)("p",null,"The API is as follows:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"API"),(0,r.kt)("th",{parentName:"tr",align:null},"return type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"compose(middlewares, app, name?)"),(0,r.kt)("td",{parentName:"tr",align:null},"IMiddleawre"),(0,r.kt)("td",{parentName:"tr",align:null},"Combine multiple middleware arrays together to return a new middleware")))),(0,r.kt)("h2",{id:"midwaydecoratorservice"},"MidwayDecoratorService"),(0,r.kt)("p",null,"Midway's built-in custom decorator service is used to implement custom decorators at the frame level."),(0,r.kt)("p",null,"It can be obtained by injection."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { MidwayDecoratorService, Inject, Controller, Get } from '@midwayjs/core';\n\n@Controller('/')\nexport class HomeController {\n\n  @Inject()\n  decoratorService: MidwayDecoratorService;\n\n  @Get('/')\n  async home() {\n    // this.decoratorService.registerPropertyHandler(/* omitted */);\n  }\n}\n")),(0,r.kt)("p",null,"The API is as follows:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"API"),(0,r.kt)("th",{parentName:"tr",align:null},"return type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"registerPropertyHandler(decoratorKey, handler)"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"Add a property decorator implementation")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"registerMethodHandler(decoratorKey, handler)"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"Add a method decorator implementation")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"registerParameterHandler(decoratorKey, handler)"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"Add a parameter decorator implementation")))),(0,r.kt)("p",null,"For more information, see ",(0,r.kt)("strong",{parentName:"p"},"Custom decorator"),"."),(0,r.kt)("h2",{id:"midwayaspectservice"},"MidwayAspectService"),(0,r.kt)("p",null,"Midway's built-in interceptor service is used to load ",(0,r.kt)("inlineCode",{parentName:"p"},"@Aspect")," related capabilities. Custom decorators also use this service."),(0,r.kt)("p",null,"It can be obtained by injection."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { MidwayAspectService, Inject, Controller, Get } from '@midwayjs/core';\n\n@Controller('/')\nexport class HomeController {\n\n  @Inject()\n  aspectService: MidwayAspectService;\n\n  @Get('/')\n  async home() {\n    // this.aspectService.interceptPrototypeMethod(/* omitted */);\n  }\n}\n")),(0,r.kt)("p",null,"The API is as follows:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"API"),(0,r.kt)("th",{parentName:"tr",align:null},"Return type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"addAspect(aspectInstance, aspectData)"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"Add an interceptor implementation")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"interceptPrototypeMethod(Clazz, methodName, aspectObject: IMethodAspect)"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"The method on the interception prototype is added to the implementation of the interceptor.")))),(0,r.kt)("h2",{id:"midwaylifecycleservice"},"MidwayLifeCycleService"),(0,r.kt)("p",null,"Midway's built-in lifecycle run service is used to run the lifecycle in the ",(0,r.kt)("inlineCode",{parentName:"p"},"configuration"),"."),(0,r.kt)("p",null,"This service is an internal method and cannot be used directly by users."),(0,r.kt)("h2",{id:"midwaymockservice"},"MidwayMockService"),(0,r.kt)("p",null,"Midway's built-in data simulation service is used to simulate data during development and single test."),(0,r.kt)("p",null,"It can be obtained by injection."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { MidwayMockService, Inject, Controller, Get } from '@midwayjs/core';\n\n@Controller('/')\nexport class HomeController {\n\n  @Inject()\n  mockService: MidwayMockService;\n\n  @Get('/')\n  async home() {\n    // this.mockService.mockProperty(/** \u7701\u7565 **/);\n  }\n}\n")),(0,r.kt)("p",null,"API is as follows"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"API"),(0,r.kt)("th",{parentName:"tr",align:null},"Return type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"mockClassProperty(clzz, propertyName, value)"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"Mock a property on a class (method)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"mockProperty(obj, key, value)"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"Mock a property (method) on a normal object")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"mockContext(app, key, vlue)"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"Properties on mock Context Objects")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"restore()"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"Empty all mock data")))),(0,r.kt)("h3",{id:"mockclassproperty"},"mockClassProperty"),(0,r.kt)("p",null,"Used to simulate a property or method of a class."),(0,r.kt)("p",null,"Like a class."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"@Provide()\nexport class UserService {\n  data;\n\n  async getUser() {\n    return 'hello';\n  }\n}\n")),(0,r.kt)("p",null,"We can also simulate in code."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"\nimport { MidwayMockService, Provide, Inject } from '@midwayjs/core';\n\n@Provide()\nclass TestMockService {\n  @Inject()\n  mockService: MidwayMockService;\n\n  mock() {\n    // Simulation method\n    this.mockService.mockClassProperty(UserService, 'getUser', async () => {\n      return 'midway';\n    });\n\n    // Simulation properties\n    this.mockService.mockClassProperty(UserService, 'data', {\n      bbb: '1'\n    });\n  }\n}\n")),(0,r.kt)("h3",{id:"mockproperty"},"mockProperty"),(0,r.kt)("p",null,"Use ",(0,r.kt)("inlineCode",{parentName:"p"},"mockProperty")," methods to simulate the properties of objects."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { MidwayMockService, Provide, Inject } from '@midwayjs/core';\n\n@Provide()\nclass TestMockService {\n  @Inject()\n  mockService: MidwayMockService;\n\n  mock() {\n    const a = {};\n    // Simulation properties\n    this.mockService.mockProperty(a, 'name', 'hello');\n    // a['name'] => 'hello'\n\n    // Simulation method\n    this.mockService.mockProperty(a, 'getUser', async () => {\n      return 'midway';\n    });\n    // await a.getUser() => 'midway'\n  }\n}\n\n")),(0,r.kt)("h3",{id:"mockcontext"},"mockContext"),(0,r.kt)("p",null,"Since Midway's Context is associated with app, app instances need to be passed in during simulation."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"mockContext")," methods are used to simulate the context."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { MidwayMockService, Configuration, App } from '@midwayjs/core';\n\n@Configuration(/**/)\nexport class MainConfiguration {\n  @Inject()\n  mockService: MidwayMockService;\n\n  @App()\n  app;\n\n  async onReady() {\n    // Simulation context\n    mockContext(app, 'user', 'midway');\n  }\n}\n\n// ctx.user => midway\n")),(0,r.kt)("p",null,"If your data is complex or logical, you can also use the callback form."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { MidwayMockService, Configuration, App } from '@midwayjs/core';\n\n@Configuration(/**/)\nexport class MainConfiguration {\n  @Inject()\n  mockService: MidwayMockService;\n\n  @App()\n  app;\n\n  async onReady() {\n    // Simulation context\n    mockContext(app, (ctx) => {\n      ctx.user = 'midway';\n    });\n  }\n}\n\n// ctx.user => midway\n")),(0,r.kt)("p",null,"Note that this mock behavior is executed before all middleware."),(0,r.kt)("h2",{id:"midwaywebrouterservice"},"MidwayWebRouterService"),(0,r.kt)("p",null,"Midway's built-in routing table service is used to apply routing and function creation."),(0,r.kt)("p",null,"It can be obtained by injection."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { MidwayWebRouterService, Configuration, Inject } from '@midwayjs/core';\n\n@Configuration({\n  // ...\n})\nexport class MainConfiguration {\n  @Inject()\n  webRouterService: MidwayWebRouterService;\n\n  async onReady() {\n    this.webRouterService.addRouter(async (ctx) => {\n      return 'hello world';\n    }, {\n      url: '/',\n      requestMethod: 'GET',\n    });\n  }\n}\n\n")),(0,r.kt)("p",null,"API is as follows"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"API"),(0,r.kt)("th",{parentName:"tr",align:null},"Return type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"addController(controllerClz, controllerOption)"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"Dynamically add a Controller")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"addRouter(routerFunction, routerInfoOption)"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"Dynamically add a routing function")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"getRouterTable()"),(0,r.kt)("td",{parentName:"tr",align:null},"Promise<Map<string, RouterInfo [] >>"),(0,r.kt)("td",{parentName:"tr",align:null},"Get hierarchical routes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"getFlattenRouterTable()"),(0,r.kt)("td",{parentName:"tr",align:null},"Promise<RouterInfo [] >"),(0,r.kt)("td",{parentName:"tr",align:null},"Get a list of flat routes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"getRoutePriorityList()"),(0,r.kt)("td",{parentName:"tr",align:null},"Promise<RouterPriority [] >"),(0,r.kt)("td",{parentName:"tr",align:null},"Get the route prefix list")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"getMatchedRouterInfo(url: string, method: string)"),(0,r.kt)("td",{parentName:"tr",align:null},"Promise<RouterInfo ","|"," undefined>"),(0,r.kt)("td",{parentName:"tr",align:null},"Returns the current matching route information based on the access path.")))),(0,r.kt)("p",null,"For more information, see ","[Web route table]","(# router_table)."),(0,r.kt)("h2",{id:"midwayserverlessfunctionservice"},"MidwayServerlessFunctionService"),(0,r.kt)("p",null,"Midway's built-in function information service inherits and ",(0,r.kt)("inlineCode",{parentName:"p"},"MidwayWebRouterService")," in almost the same way."),(0,r.kt)("p",null,"It can be obtained by injection."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { MidwayServerlessFunctionService, Configuration, Inject } from '@midwayjs/core';\n\n@Configuration({\n  // ...\n})\nexport class MainConfiguration {\n  @Inject()\n  serverlessFunctionService: MidwayServerlessFunctionService;\n\n  async onReady() {\n    this.serverlessFunctionService.addServerlessFunction(async (ctx, event) => {\n      return 'hello world';\n    }, {\n      type: ServerlessTriggerType.HTTP,\n      metadata: {\n        method: 'get',\n        path: '/api/hello'\n      },\n      functionName: 'hello',\n      handlerName: 'index.hello',\n    });\n  }\n}\n\n")),(0,r.kt)("p",null,"API is as follows"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"API"),(0,r.kt)("th",{parentName:"tr",align:null},"Return type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"addServerlessFunction(fn, triggerOptions, functionOptions)"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"Dynamically add a function")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"getFunctionList()"),(0,r.kt)("td",{parentName:"tr",align:null},"Promise<RouterInfo [] >"),(0,r.kt)("td",{parentName:"tr",align:null},"Get a list of all functions")))),(0,r.kt)("p",null,"For more information, see ","[Web route table]","(# router_table)."),(0,r.kt)("h2",{id:"midwayhealthservice"},"MidwayHealthService"),(0,r.kt)("p",null,"Midway's built-in health check execution service is used for externally extended health check capabilities."),(0,r.kt)("p",null,"A complete health check consists of two parts:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"The trigger end of the health check, such as an external scheduled request, is usually an Http interface"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li",start:2},(0,r.kt)("li",{parentName:"ol"},"The execution end of the health check usually checks whether specific items are normal in each component or business.")))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"MidwayHealthService")," is generally used as the trigger end of health check. The content described below is generally implemented on the trigger end."),(0,r.kt)("p",null,"It can be obtained through injection and then perform health check tasks."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'import { MidwayHealthService, Configuration, Inject } from \'@midwayjs/core\';\n\n@Configuration({\n  // ...\n})\nexport class MainConfiguration {\n  @Inject()\n  healthService: MidwayHealthService;\n\n  async onServerReady() {\n    setInterval(() => {\n      const results = await this.healthService.getStatus();\n      \n      // console.log(results);\n      // =>\n      // {\n      //   "status": false\n      //   "namespace": "redis",\n      //   "reason": "health check timeout",\n      //   "results": [\n      //      {\n      //        "status": false\n      //        "reason": "health check timeout",\n      //        "namespace": "redis"\n      //      }\n      //    ]\n      // }\n      \n    }, 1000);\n    // ...\n  }\n}\n')),(0,r.kt)("p",null,"The API is as follows"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"API"),(0,r.kt)("th",{parentName:"tr",align:null},"Return Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"getStatus()"),(0,r.kt)("td",{parentName:"tr",align:null},"Promise<HealthResults",">"),(0,r.kt)("td",{parentName:"tr",align:null},"Dynamically add a function")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"setCheckTimeout(timeout: number)"),(0,r.kt)("td",{parentName:"tr",align:null},"void"),(0,r.kt)("td",{parentName:"tr",align:null},"Set timeout")))),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"getStatus")," method is used to externally call the ",(0,r.kt)("inlineCode",{parentName:"p"},"onHealthCheck")," method in polling ",(0,r.kt)("inlineCode",{parentName:"p"},"configuration")," and return a data that conforms to the ",(0,r.kt)("inlineCode",{parentName:"p"},"HealthResults")," structure."),(0,r.kt)("p",null,"  ",(0,r.kt)("inlineCode",{parentName:"p"},"HealthResults")," contains several fields. ",(0,r.kt)("inlineCode",{parentName:"p"},"status")," indicates whether the check is successful. If it fails, ",(0,r.kt)("inlineCode",{parentName:"p"},"reason")," indicates the reason for the first failed component. ",(0,r.kt)("inlineCode",{parentName:"p"},"namespace")," represents the name of the first failed component. ",(0,r.kt)("inlineCode",{parentName:"p"},"results")," It means that all the returned items are checked this time, and the structure of the returned items is the same as the external one."),(0,r.kt)("p",null,"When executing the process, if the following conditions occur in the ",(0,r.kt)("inlineCode",{parentName:"p"},"onHealthCheck")," method, it will be marked as failed."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"No data conforming to the ",(0,r.kt)("inlineCode",{parentName:"li"},"HealthResult")," structure was returned."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li",start:2},(0,r.kt)("li",{parentName:"ol"},"No value returned"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li",start:3},(0,r.kt)("li",{parentName:"ol"},"Execution timeout"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li",start:4},(0,r.kt)("li",{parentName:"ol"},"Throw an error"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li",start:5},(0,r.kt)("li",{parentName:"ol"},"Return error data that conforms to the ",(0,r.kt)("inlineCode",{parentName:"li"},"HealthResult")," structure, such as ",(0,r.kt)("inlineCode",{parentName:"li"},"{status: false}"))))),(0,r.kt)("p",null,"The default waiting timeout for health checks is 1s."),(0,r.kt)("p",null,"Can be overridden using global configuration."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"//config.default\nexport default {\n   core: {\n     healthCheckTimeout: 2000,\n   }\n};\n")),(0,r.kt)("p",null,"The execution end of the health check is implemented in the life cycle of the business or component. For details, please see ",(0,r.kt)("a",{parentName:"p",href:"/docs/lifecycle#onhealthcheck"},"Life Cycle"),"."))}m.isMDXComponent=!0}}]);