"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[47023],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>f});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=s(n),m=r,f=u["".concat(p,".").concat(m)]||u[m]||c[m]||i;return n?a.createElement(f,o(o({ref:t},d),{},{components:n})):a.createElement(f,o({ref:t},d))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=m;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[u]="string"==typeof e?e:r,o[1]=l;for(var s=2;s<i;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},92159:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var a=n(87462),r=(n(67294),n(3905));const i={},o="Koa",l={unversionedId:"extensions/koa",id:"extensions/koa",title:"Koa",description:"Koa is a very lightweight and easy-to-use Web framework. The content of this chapter mainly introduces how to use Koa as the upper-level framework in Midway and use its own capabilities.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/extensions/koa.md",sourceDirName:"extensions",slug:"/extensions/koa",permalink:"/en/docs/extensions/koa",draft:!1,editUrl:"https://github.com/midwayjs/midway/tree/main/site/docs/extensions/koa.md",tags:[],version:"current",frontMatter:{},sidebar:"component",previous:{title:"JWT",permalink:"/en/docs/extensions/jwt"},next:{title:"EggJS",permalink:"/en/docs/extensions/egg"}},p={},s=[{value:"Installation dependency",id:"installation-dependency",level:2},{value:"Enable component",id:"enable-component",level:2},{value:"BodyParser",id:"bodyparser",level:2},{value:"Cookie and Session",id:"cookie-and-session",level:2},{value:"Extended Context",id:"extended-context",level:2},{value:"Get Http Server",id:"get-http-server",level:2},{value:"State type definition",id:"state-type-definition",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Default configuration",id:"default-configuration",level:3},{value:"Modify port",id:"modify-port",level:3},{value:"Global prefix",id:"global-prefix",level:3},{value:"Reverse proxy configuration",id:"reverse-proxy-configuration",level:3},{value:"Https configuration",id:"https-configuration",level:3},{value:"favicon settings",id:"favicon-settings",level:3},{value:"Modify context log",id:"modify-context-log",level:3},{value:"Query array parsing",id:"query-array-parsing",level:3}],d={toc:s},u="wrapper";function c(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"koa"},"Koa"),(0,r.kt)("p",null,"Koa is a very lightweight and easy-to-use Web framework. The content of this chapter mainly introduces how to use Koa as the upper-level framework in Midway and use its own capabilities."),(0,r.kt)("p",null,"Midway's default examples are based on this package."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"@midwayjs/koa")," package uses ",(0,r.kt)("inlineCode",{parentName:"p"},"koa @2")," and integrates ",(0,r.kt)("inlineCode",{parentName:"p"},"@koa/router")," as the basic routing capability by default, and has built-in ",(0,r.kt)("inlineCode",{parentName:"p"},"session")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"body-parser")," functions by default."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null}))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Contains independent main framework"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Contains independent logs"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705")))),(0,r.kt)("h2",{id:"installation-dependency"},"Installation dependency"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ npm i @midwayjs/koa@3 --save\n")),(0,r.kt)("p",null,"Or reinstall the following dependencies in ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "dependencies": {\n    "@midwayjs/koa": "^3.0.0",\n    // ...\n  },\n}\n')),(0,r.kt)("p",null,"Examples can also be created directly using scaffolding."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# npm v6\n$ npm init midway --type=koa-v3 my_project\n\n# npm v7\n$ npm init midway -- --type=koa-v3 my_project\n")),(0,r.kt)("h2",{id:"enable-component"},"Enable component"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Configuration, App } from '@midwayjs/core';\nimport * as koa from '@midwayjs/koa';\nimport { join } from 'path';\n\n@Configuration({\n  imports: [koa]\n  importConfigs: [join(__dirname, './config')]\n})\nexport class MainConfiguration {\n  @App()\n  app: koa.Application;\n\n  async onReady() {\n        // ...\n  }\n}\n\n")),(0,r.kt)("h2",{id:"bodyparser"},"BodyParser"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"@midwayjs/koa")," has its own ",(0,r.kt)("inlineCode",{parentName:"p"},"bodyParser")," function, which will parse ",(0,r.kt)("inlineCode",{parentName:"p"},"Post")," requests by default and automatically recognize ",(0,r.kt)("inlineCode",{parentName:"p"},"json")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"form")," types."),(0,r.kt)("p",null,"If you need text or xml, you can configure it yourself."),(0,r.kt)("p",null,"The default size is limited to ",(0,r.kt)("inlineCode",{parentName:"p"},"1mb"),". You can set the size of each item separately."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default\nexport default {\n  // ...\n  bodyParser: {\n    enableTypes: ['json', 'form', 'text', 'xml']\n    formLimit: '1mb',\n    jsonLimit: '1mb',\n    textLimit: '1mb',\n    xmlLimit: '1mb',\n  },\n}\n")),(0,r.kt)("p",null,"Note that the type selection when using Postman for Post requests:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://img.alicdn.com/imgextra/i4/O1CN01QCdTsN1S347SuzZU5_!!6000000002190-2-tps-1017-690.png",alt:"postman"})),(0,r.kt)("p",null,"Disable bodyParser middleware\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default\nexport default {\n  // ...\n  bodyParser: {\n    enable: false,\n    // ...\n  },\n}\n")),(0,r.kt)("h2",{id:"cookie-and-session"},"Cookie and Session"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"@midwayjs/koa")," encapsulates ",(0,r.kt)("inlineCode",{parentName:"p"},"cookies")," parsing and ",(0,r.kt)("inlineCode",{parentName:"p"},"Session")," support by default. You can view ",(0,r.kt)("a",{parentName:"p",href:"../cookie_session"},"Cookies and Session"),"."),(0,r.kt)("h2",{id:"extended-context"},"Extended Context"),(0,r.kt)("p",null,"In some scenarios, the Context needs to be expanded."),(0,r.kt)("p",null,"If you want to hang some temporary request-related object data, you can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"ctx.setAttr(key, value)")," API to implement it, such as the data used by the component."),(0,r.kt)("p",null,"If you really want to extend the Context, you can use koa's own API."),(0,r.kt)("p",null,"For example, we extend in ",(0,r.kt)("inlineCode",{parentName:"p"},"configuration.ts")," to provide a ",(0,r.kt)("inlineCode",{parentName:"p"},"render()")," method."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { App, Configuration } from '@midwayjs/core';\nimport * as koa from '@midwayjs/koa';\n\n@Configuration({\n    // ...\n})\nexport class MainConfiguration {\n  @App()\n  app: koa.Application;\n\n  async onReady(container) {\n    Object.defineProperties(app.context, {\n      render: {\n        value: async function (...args) {\n          // ...\n        },\n      },\n    });\n  }\n}\n")),(0,r.kt)("p",null,"However, this cannot directly allow the Context to include Typescript Definitions. Additional definitions are required. Please refer to ",(0,r.kt)("a",{parentName:"p",href:"../context_definition"},"extended context definitions"),"."),(0,r.kt)("h2",{id:"get-http-server"},"Get Http Server"),(0,r.kt)("p",null,"In some special cases, you need to get the original Http Server, we can get it after the server starts."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { App, Configuration } from '@midwayjs/core';\nimport * as koa from '@midwayjs/koa';\n\n@Configuration({\n    // ...\n})\nexport class MainConfiguration {\n  @Inject()\n  framework: koa.Framework;\n\n  async onServerReady(container) {\n    const server = this.framework.getServer();\n    // ...\n  }\n}\n")),(0,r.kt)("h2",{id:"state-type-definition"},"State type definition"),(0,r.kt)("p",null,"There is a special State attribute in koa's Context, and the State definition can be extended in a similar way to Context."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/interface.ts\n\ndeclare module '@midwayjs/koa/dist/interface' {\n  interface Context {\n    abc: string;\n  }\n\n  interface State{\n    bbb: string;\n    ccc: number;\n  }\n}\n")),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("h3",{id:"default-configuration"},"Default configuration"),(0,r.kt)("p",null,"The configuration sample of ",(0,r.kt)("inlineCode",{parentName:"p"},"@midwayjs/Koa")," is as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default\nexport default {\n  // ...\n  koa: {\n    port: 7001\n  },\n}\n")),(0,r.kt)("p",null,"All attributes are described as follows:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Property"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"port"),(0,r.kt)("td",{parentName:"tr",align:null},"Number"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional, port to start")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"globalPrefix"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"optional. the global http prefix")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"keys"),(0,r.kt)("td",{parentName:"tr",align:null},"string[]"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional, Cookies signature, if the upper layer does not write keys, you can also set it here")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hostname"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional. The hostname to listen to. Default 127.1")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Key"),(0,r.kt)("td",{parentName:"tr",align:null},"string ","|"," Buffer ","|"," Array<Buffer","|","Object>"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional, Https key, server private key")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"cert"),(0,r.kt)("td",{parentName:"tr",align:null},"string ","|"," Buffer ","|"," Array<Buffer","|","Object>"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional, Https cert, server certificate")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ca"),(0,r.kt)("td",{parentName:"tr",align:null},"string ","|"," Buffer ","|"," Array<Buffer","|","Object>"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional, Https ca")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"http2"),(0,r.kt)("td",{parentName:"tr",align:null},"boolean"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional, supported by http2, default false")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"proxy"),(0,r.kt)("td",{parentName:"tr",align:null},"boolean"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional, whether to enable the proxy. If it is true, the IP in the request request will be obtained first from the X-Forwarded-For in the Header field. The default is false.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"subdomainOffset"),(0,r.kt)("td",{parentName:"tr",align:null},"number"),(0,r.kt)("td",{parentName:"tr",align:null},"optional, the offset of the subdomain name, default 2.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"proxyIpHeader"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"optional. obtains the field name of the proxy ip address. the default value is X-Forwarded-For")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"maxIpsCount"),(0,r.kt)("td",{parentName:"tr",align:null},"number"),(0,r.kt)("td",{parentName:"tr",align:null},"optional. the maximum number of ips obtained, which is 0 by default.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"serverTimeout"),(0,r.kt)("td",{parentName:"tr",align:null},"number"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional, server timeout configuration, the default is 2 ",(0,r.kt)("em",{parentName:"td"}," 60 ")," 1000 (2 minutes), in milliseconds")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"serverOptions"),(0,r.kt)("td",{parentName:"tr",align:null},"Record<string, any>"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional\uff0chttp Server ",(0,r.kt)("a",{parentName:"td",href:"https://nodejs.org/docs/latest/api/http.html#httpcreateserveroptions-requestlistener"},"Options"))))),(0,r.kt)("h3",{id:"modify-port"},"Modify port"),(0,r.kt)("p",null,"By default, we provide the ",(0,r.kt)("inlineCode",{parentName:"p"},"7001")," default port parameter in ",(0,r.kt)("inlineCode",{parentName:"p"},"config.default"),". by modifying it, we can modify the default port of koa http service."),(0,r.kt)("p",null,"For example, we changed it to ",(0,r.kt)("inlineCode",{parentName:"p"},"6001"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default\nexport default {\n  // ...\n  koa: {\n    port: 6001\n  },\n}\n")),(0,r.kt)("p",null,"By default, our port configuration is ",(0,r.kt)("inlineCode",{parentName:"p"},"null")," because the single-test environment requires supertest to start the port."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.unittest\nexport default {\n  // ...\n  koa: {\n    port: null\n  },\n}\n")),(0,r.kt)("p",null,"In addition, you can also temporarily modify the port by ",(0,r.kt)("inlineCode",{parentName:"p"},"midway-bin dev-ts-port = 6001"),", which overwrites the configured port."),(0,r.kt)("h3",{id:"global-prefix"},"Global prefix"),(0,r.kt)("p",null,"For more information about this feature, see ","[Global Prefixes]","(../controller# Global Routing Prefix)."),(0,r.kt)("h3",{id:"reverse-proxy-configuration"},"Reverse proxy configuration"),(0,r.kt)("p",null,"If you use a reverse proxy such as Nginx, please enable the ",(0,r.kt)("inlineCode",{parentName:"p"},"proxy")," configuration."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default\nexport default {\n   // ...\n   koa: {\n     proxy: true,\n   },\n}\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"X-Forwarded-For")," Header is used by default. If the proxy configuration is different, please configure a different Header yourself."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default\nexport default {\n   // ...\n   koa: {\n     proxy: true,\n     proxyIpHeader: 'X-Forwarded-Host'\n   },\n}\n")),(0,r.kt)("h3",{id:"https-configuration"},"Https configuration"),(0,r.kt)("p",null,"In most cases, please use external agents as much as possible to complete the implementation of Https, such as Nginx."),(0,r.kt)("p",null,"In some special scenarios, you can directly turn on Https by configuring SSL certificates (TLS certificates)."),(0,r.kt)("p",null,"First, you must prepare certificate files in advance, such as ",(0,r.kt)("inlineCode",{parentName:"p"},"ssl.key")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"ssl.pem"),". The key is the private key of the server and the pem is the corresponding certificate."),(0,r.kt)("p",null,"Then configure it."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default\nimport { readFileSync } from 'fs';\nimport { join } from 'path';\n\nexport default {\n  // ...\n  koa: {\n    key: join(__dirname, '../ssl/ssl.key')\n    cert: join(__dirname, '../ssl/ssl.pem')\n  },\n}\n")),(0,r.kt)("h3",{id:"favicon-settings"},"favicon settings"),(0,r.kt)("p",null,"By default, the browser will initiate a request to ",(0,r.kt)("inlineCode",{parentName:"p"},"favicon.ico"),"."),(0,r.kt)("p",null,"The framework provides a default middleware to handle the request, and you can specify a ",(0,r.kt)("inlineCode",{parentName:"p"},"favicon")," Buffer."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default\nimport { readFileSync } from 'fs';\nimport { join } from 'path';\n\nexport default {\n  // ...\n  siteFile: {\n    favicon: readFileSync(join(__dirname, '../static/fav.ico'))\n  },\n}\n")),(0,r.kt)("p",null,"If the ",(0,r.kt)("inlineCode",{parentName:"p"},"@midwayjs/static-file")," component is turned on, static file hosting of the component will be preferred."),(0,r.kt)("p",null,"Disable middleware\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default\nexport default {\n  // ...\n  siteFile: {\n    enable: false,\n    // ...\n  },\n}\n")),(0,r.kt)("h3",{id:"modify-context-log"},"Modify context log"),(0,r.kt)("p",null,"The context log of the koa framework can be modified separately."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"export default {\n  koa: {\n    contextLoggerFormat: info => {\n      const ctx = info.ctx;\n      return '${info.timestamp} ${info.LEVEL} ${info.pid} [${ctx.userId} - ${Date.now() - ctx.startTime}ms ${ctx.method}] ${info.message}';\n    }\n    // ...\n  },\n};\n")),(0,r.kt)("h3",{id:"query-array-parsing"},"Query array parsing"),(0,r.kt)("p",null,"By default, koa uses ",(0,r.kt)("inlineCode",{parentName:"p"},"querystring")," to parse query parameters, and when it encounters an array, it will split the data in the array."),(0,r.kt)("p",null,"for example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"GET /query?a[0]=1&a[1]=2\n")),(0,r.kt)("p",null,"The result obtained is:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n     "a[0]": 1,\n     "a[1]": 2,\n}\n')),(0,r.kt)("p",null,"The framework provides some parameters to handle this situation."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default\nexport default {\n   // ...\n   koa: {\n     queryParseMode: 'extended',\n     // ...\n   },\n}\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"queryParseMode")," parameter can choose from three values: ",(0,r.kt)("inlineCode",{parentName:"p"},"extended"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"strict"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"first"),"."),(0,r.kt)("p",null,"  When ",(0,r.kt)("inlineCode",{parentName:"p"},"queryParseMode")," has a value, the ",(0,r.kt)("inlineCode",{parentName:"p"},"qs")," module will be used to process the query, and the effect is the same as the ",(0,r.kt)("inlineCode",{parentName:"p"},"koa-qs")," module."),(0,r.kt)("p",null,"When the request parameter is ",(0,r.kt)("inlineCode",{parentName:"p"},"/query?a=1&b=2&a=3&c[0]=1&c[1]=2'"),"."),(0,r.kt)("p",null,"Default effect (using ",(0,r.kt)("inlineCode",{parentName:"p"},"querystring"),")"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-JSON"},'{\n   "a": ["1", "3" ],\n   "b": "2",\n   "c[0]": "1",\n   "c[1]": "2"\n}\n')),(0,r.kt)("p",null,"  ",(0,r.kt)("inlineCode",{parentName:"p"},"extended")," effect"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-JSON"},'{\n   "a": ["1", "3" ],\n   "b": ["2"],\n   "c": ["1", "2"]\n}\n')),(0,r.kt)("p",null,"  ",(0,r.kt)("inlineCode",{parentName:"p"},"strict")," effect"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-JSON"},'{\n   "a": ["1", "3" ],\n   "b": "2",\n   "c": ["1", "2"]\n}\n')),(0,r.kt)("p",null,"  ",(0,r.kt)("inlineCode",{parentName:"p"},"first")," effect"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-JSON"},'{\n   "a": "1",\n   "b": "2",\n   "c": "1"\n}\n\n### Timeout Configuration\n\nRequestTimeout and ServerTimeout are two different timeout scenarios.\n\n- `serverTimeout`: Used to set the timeout for the server to wait for the client to send data after receiving a request. If the client does not send any data within this time, the server will close the connection. This timeout applies to the entire request-response cycle, including request headers, request body, and response.\n- `requestTimeout`: Used to set the timeout for the server to wait for the client to send a complete request. This timeout applies specifically to request headers and request body. If the complete request is not received within this time, the server will abort the request.\n\nBy default, `serverTimeout` is set to 0 and does not trigger a timeout.\n\nIf needed, you can modify the configuration by specifying the timeout in milliseconds.\n\n\n```typescript\n// src/config/config.default\nexport default {\n  // ...\n  koa: {\n    serverTimeout: 100_000\n  },\n}\n')),(0,r.kt)("p",null,"If you encounter the ",(0,r.kt)("inlineCode",{parentName:"p"},"ERR_HTTP_REQUEST_TIMEOUT")," error, it means that the ",(0,r.kt)("inlineCode",{parentName:"p"},"requestTimeout")," has been triggered, which defaults to ",(0,r.kt)("inlineCode",{parentName:"p"},"300_000")," (5 minutes) in milliseconds. You can modify this timeout by configuring as follows."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default\nexport default {\n  // ...\n  koa: {\n    serverOptions: {\n      requestTimeout: 600_000\n    }\n  },\n}\n")))}c.isMDXComponent=!0}}]);