"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[50432],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(n),m=a,h=d["".concat(l,".").concat(m)]||d[m]||u[m]||o;return n?r.createElement(h,i(i({ref:t},p),{},{components:n})):r.createElement(h,i({ref:t},p))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:a,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},43448:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var r=n(87462),a=(n(67294),n(3905));const o={},i="Cross-domain",s={unversionedId:"extensions/cross_domain",id:"extensions/cross_domain",title:"Cross-domain",description:"Common cross-domain components are applicable to @midwayjs/faas, @midwayjs/web, @midwayjs/koa, and @midwayjs/express frameworks, and support multiple modes of cors and jsonp.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/extensions/cross_domain.md",sourceDirName:"extensions",slug:"/extensions/cross_domain",permalink:"/en/docs/extensions/cross_domain",draft:!1,editUrl:"https://github.com/midwayjs/midway/tree/main/site/docs/extensions/cross_domain.md",tags:[],version:"current",frontMatter:{},sidebar:"component",previous:{title:"Static file hosting",permalink:"/en/docs/extensions/static_file"},next:{title:"HTTP proxy",permalink:"/en/docs/extensions/http-proxy"}},l={},c=[{value:"Installation dependency",id:"installation-dependency",level:2},{value:"Introducing components",id:"introducing-components",level:2},{value:"What is Cross-Origin",id:"what-is-cross-origin",level:2},{value:"Scenario Setup",id:"scenario-setup",level:3},{value:"What is CORS",id:"what-is-cors",level:2},{value:"Common CORS configurations",id:"common-cors-configurations",level:2},{value:"<code>credentials</code> not used",id:"credentials-not-used",level:3},{value:"Using <code>credentials</code>",id:"using-credentials",level:3},{value:"Limit <code>origin</code>",id:"limit-origin",level:3},{value:"More CORS configuration",id:"more-cors-configuration",level:2},{value:"JSONP configuration",id:"jsonp-configuration",level:2}],p={toc:c},d="wrapper";function u(e){let{components:t,...n}=e;return(0,a.kt)(d,(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"cross-domain"},"Cross-domain"),(0,a.kt)("p",null,"Common cross-domain components are applicable to ",(0,a.kt)("inlineCode",{parentName:"p"},"@midwayjs/faas"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"@midwayjs/web"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"@midwayjs/koa"),", and ",(0,a.kt)("inlineCode",{parentName:"p"},"@midwayjs/express")," frameworks, and support multiple modes of ",(0,a.kt)("inlineCode",{parentName:"p"},"cors")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"jsonp"),"."),(0,a.kt)("p",null,"Related information:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Web support"),(0,a.kt)("th",{parentName:"tr",align:null}))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@midwayjs/koa"),(0,a.kt)("td",{parentName:"tr",align:null},"\u2705")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@midwayjs/faas"),(0,a.kt)("td",{parentName:"tr",align:null},"\u2705")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@midwayjs/web"),(0,a.kt)("td",{parentName:"tr",align:null},"\u2705")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@midwayjs/express"),(0,a.kt)("td",{parentName:"tr",align:null},"\u2705")))),(0,a.kt)("h2",{id:"installation-dependency"},"Installation dependency"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ npm i @midwayjs/cross-domain --save\n")),(0,a.kt)("h2",{id:"introducing-components"},"Introducing components"),(0,a.kt)("p",null,"Introducing components in ",(0,a.kt)("inlineCode",{parentName:"p"},"src/configuration.ts"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import * as crossDomain from '@midwayjs/cross-domain';\n@Configuration({\n  imports: [\n    // ...other components\n    crossDomain\n  ],\n})\nexport class MainConfiguration {}\n")),(0,a.kt)("h2",{id:"what-is-cross-origin"},"What is Cross-Origin"),(0,a.kt)("p",null,"Suppose there are two websites:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"A.com"),": This is your website, where you want to access some resources."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"B.com"),": This is another website that possesses the resources you wish to access.")),(0,a.kt)("h3",{id:"scenario-setup"},"Scenario Setup"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"A.com")," is your main website, where you run some JavaScript code."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"B.com")," has some API interfaces that you want to call through JavaScript code on A.com.")),(0,a.kt)("p",null,"Due to the same-origin policy, browsers do not allow JavaScript code from A.com to directly access resources from B.com by default. This is because browsers, for security reasons, prevent malicious websites from reading sensitive data from other sites. You want to initiate a request to B.com's API interface from JavaScript code running on A.com, and this request is considered a cross-origin request."),(0,a.kt)("p",null,"In simple terms, accessing B.com's interface from A.com is cross-origin."),(0,a.kt)("p",null,"Additionally, there are some conditions for cross-origin:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"The same-origin policy is part of the browser's security mechanism, so cross-origin issues generally only arise when accessing from a browser."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("ol",{parentName:"li",start:2},(0,a.kt)("li",{parentName:"ol"},"When a browser initiates a cross-origin request, it automatically adds an ",(0,a.kt)("inlineCode",{parentName:"li"},"Origin")," header to the request based on the current origin, and the server also judges the source based on the ",(0,a.kt)("inlineCode",{parentName:"li"},"origin")," header and processes accordingly.")))),(0,a.kt)("p",null,"So, when you find that cross-origin settings are not effective, please check:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"Whether it is indeed a cross-origin request."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("ol",{parentName:"li",start:2},(0,a.kt)("li",{parentName:"ol"},"Whether it is indeed initiated from a browser."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("ol",{parentName:"li",start:3},(0,a.kt)("li",{parentName:"ol"},"Whether the request carries an ",(0,a.kt)("inlineCode",{parentName:"li"},"origin")," header.")))),(0,a.kt)("h2",{id:"what-is-cors"},"What is CORS"),(0,a.kt)("p",null,"The following errors are often encountered when front-end code calls back-end services. This is the most common cross-domain ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS"},"CORS")," error. ."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Access to fetch at 'http://127.0.0.1:7002/' from origin 'http://127.0.0.1:7001' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource. If an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled.\n")),(0,a.kt)("p",null,"For security reasons, browsers restrict cross-origin HTTP requests made within scripts. For example, ",(0,a.kt)("inlineCode",{parentName:"p"},"XMLHttpRequest")," and ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-CN/docs/Web/API/Fetch_API"},"Fetch API")," follow the ","[Same Origin Policy]","(",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/"},"https://developer.mozilla.org/")," en-CN/docs/Web/Security/Same-origin_policy). This means that web applications using these APIs can only request HTTP resources from the same domain where the application is loaded unless the response message contains the correct CORS response headers."),(0,a.kt)("p",null,"The CORS mechanism allows web application servers to perform cross-origin access control so that cross-origin data transmission can be carried out securely. Modern browsers support this in API containers such as ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest"},(0,a.kt)("inlineCode",{parentName:"a"},"XMLHttpRequest"))," or ","[Fetch]","(",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla"},"https://developer.mozilla")," .org/zh-CN/docs/Web/API/Fetch_API)) uses CORS to reduce the risks caused by cross-origin HTTP requests."),(0,a.kt)("h2",{id:"common-cors-configurations"},"Common CORS configurations"),(0,a.kt)("p",null,"Below are several cross-domain solutions. Let\u2019s take the ",(0,a.kt)("inlineCode",{parentName:"p"},"fetch")," method as an example."),(0,a.kt)("h3",{id:"credentials-not-used"},(0,a.kt)("inlineCode",{parentName:"h3"},"credentials")," not used"),(0,a.kt)("p",null,"client."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"fetch(url);\n")),(0,a.kt)("p",null,"Server configuration."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default.ts\nexport default {\n   // ...\n   cors: {\n     origin: '*',\n   },\n}\n")),(0,a.kt)("h3",{id:"using-credentials"},"Using ",(0,a.kt)("inlineCode",{parentName:"h3"},"credentials")),(0,a.kt)("p",null,"client."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'fetch(url, {\n   credentials: "include",\n});\n')),(0,a.kt)("p",null,"Server configuration"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default.ts\nexport default {\n   // ...\n   cors: {\n     credentials: true,\n   },\n}\n")),(0,a.kt)("h3",{id:"limit-origin"},"Limit ",(0,a.kt)("inlineCode",{parentName:"h3"},"origin")),(0,a.kt)("p",null,"Suppose our web page address is ",(0,a.kt)("inlineCode",{parentName:"p"},"http://127.0.0.1:7001")," and the interface is ",(0,a.kt)("inlineCode",{parentName:"p"},"http://127.0.0.1:7002"),"."),(0,a.kt)("p",null,"client."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"fetch('http://127.0.0.1:7002/', {\n   credentials: 'include'\n})\n")),(0,a.kt)("p",null,"Server configuration, please note that since ",(0,a.kt)("inlineCode",{parentName:"p"},"credentials")," is enabled, the ",(0,a.kt)("inlineCode",{parentName:"p"},"origin")," field cannot be ",(0,a.kt)("inlineCode",{parentName:"p"},"*")," at this time."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default.ts\nexport default {\n   // ...\n   cors: {\n     origin: 'http://127.0.0.1:7001',\n     credentials: true,\n   },\n}\n")),(0,a.kt)("h2",{id:"more-cors-configuration"},"More CORS configuration"),(0,a.kt)("p",null,"The available configurations are as follows:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"export const cors = {\n    // Allow cross-domain methods, [default value] is GET, HEAD, PUT, POST, DELETE, PATCH\n  allowMethods: string |string[];\n  // Set the value of Access-Control-Allow-Origin, and [Default] will get the origin on the request header\n  // It can also be configured as a callback method. The input parameter is request and the origin value needs to be returned.\n  // For example: http://test.midwayjs.org\n  // If credentials is set, origin cannot be set *\n  origin: string|Function;\n  // Set the value of Access-Control-Allow-Headers, [Default] will get Access-Control-Request-Headers on the request head\n  allowHeaders: string |string[];\n  // Set the value of Access-Control-Expose-Headers\n  exposeHeaders: string |string[];\n  // Set Access-Control-Allow-Credentials, [Default] false\n   // It can also be configured as a callback method. The input parameter is request and the return value is true or false.\n  credentials: boolean|Function;\n  // Whether to write cross-domain header information to the headers attribute of the error pair when an error is reported, [default value] false\n  keepHeadersOnError: boolean;\n    // set Access-Control-Max-Age\n  maxAge: number;\n}\n")),(0,a.kt)("h2",{id:"jsonp-configuration"},"JSONP configuration"),(0,a.kt)("p",null,"JSONP can be configured in ",(0,a.kt)("inlineCode",{parentName:"p"},"src/config/config.default"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/config/config.default.ts\nexport default {\n  // ...\n  jsonp: {\n    callback: 'jsonp',\n    limit: 512\n  },\n}\n")))}u.isMDXComponent=!0}}]);