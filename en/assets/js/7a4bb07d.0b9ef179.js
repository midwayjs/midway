"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[91677],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>f});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),p=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(s.Provider,{value:n},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(t),m=r,f=d["".concat(s,".").concat(m)]||d[m]||u[m]||i;return t?a.createElement(f,o(o({ref:n},c),{},{components:t})):a.createElement(f,o({ref:n},c))}));function f(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=m;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[d]="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=t[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},96953:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var a=t(87462),r=(t(67294),t(3905));const i={},o="Tenant",l={unversionedId:"extensions/tenant",id:"extensions/tenant",title:"Tenant",description:"Here's how to quickly use tenant components in Midway.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/extensions/tenant.md",sourceDirName:"extensions",slug:"/extensions/tenant",permalink:"/en/docs/extensions/tenant",draft:!1,editUrl:"https://github.com/midwayjs/midway/tree/main/site/docs/extensions/tenant.md",tags:[],version:"current",frontMatter:{},sidebar:"component",previous:{title:"Captcha",permalink:"/en/docs/extensions/captcha"},next:{title:"TypeORM",permalink:"/en/docs/extensions/orm"}},s={},p=[{value:"Tenant definition",id:"tenant-definition",level:2},{value:"Install dependencies",id:"install-dependencies",level:2},{value:"Tenant information access",id:"tenant-information-access",level:2}],c={toc:p},d="wrapper";function u(e){let{components:n,...t}=e;return(0,r.kt)(d,(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"tenant"},"Tenant"),(0,r.kt)("p",null,"Here's how to quickly use tenant components in Midway."),(0,r.kt)("p",null,"Related Information:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null}))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Available for standard projects"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Available for Serverless"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Available for integration"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Contains independent main frame"),(0,r.kt)("td",{parentName:"tr",align:null},"\u274c")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Contains standalone logs"),(0,r.kt)("td",{parentName:"tr",align:null},"\u274c")))),(0,r.kt)("h2",{id:"tenant-definition"},"Tenant definition"),(0,r.kt)("p",null,"Tenant management is a function often required in the middle and back-end business development process."),(0,r.kt)("p",null,'During development, different users need to be stored in different data sources, namespaces or areas. These different data areas are collectively called "tenants".'),(0,r.kt)("h2",{id:"install-dependencies"},"Install dependencies"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"@midwayjs/tenant")," is the main function package."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ npm i @midwayjs/tenant@3 --save\n")),(0,r.kt)("p",null,"Or add the following dependencies in ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json")," and reinstall."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n   "dependencies": {\n     "@midwayjs/tenant": "^3.0.0",\n     // ...\n   }\n}\n')),(0,r.kt)("p",null,"##Introduce components"),(0,r.kt)("p",null,"First, introduce the component and import it in ",(0,r.kt)("inlineCode",{parentName:"p"},"src/configuration.ts"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Configuration } from '@midwayjs/core';\nimport * as tenant from '@midwayjs/tenant';\n\n@Configuration({\n   imports: [\n     // ...\n     tenant,\n   ],\n})\nexport class MainConfiguration {\n}\n")),(0,r.kt)("h2",{id:"tenant-information-access"},"Tenant information access"),(0,r.kt)("p",null,"Different tenant data are isolated from each other. Generally speaking, each user data is associated with relevant tenant information. After the user information is obtained through user authentication, its corresponding tenant data is obtained for subsequent data reading and writing."),(0,r.kt)("p",null,"In Midway, tenant data can be saved in the request object ctx and can be used by all subsequent request scope objects. However, it is not enough for tenant information to be used only in the request link. It needs to be effective in different scopes, which requires a new architecture to support it."),(0,r.kt)("p",null,"The component provides a ",(0,r.kt)("inlineCode",{parentName:"p"},"TenantManager")," to manage tenant information."),(0,r.kt)("p",null,"You need to save tenant information in each request link before retrieving it later."),(0,r.kt)("p",null,"The format of tenant information can be defined as required."),(0,r.kt)("p",null,"for example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"interface TenantInfo {\n   id: string;\n   name: string;\n}\n")),(0,r.kt)("p",null,"For example, save in middleware."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { TenantManager } from '@midwayjs/tenant';\nimport { Middleware, Inject } from '@midwayjs/core';\n\n@Middleware()\nclass TenantMiddleware {\n   @Inject()\n   tenantManager: tenant.TenantManager;\n\n   resolve() {\n     return async(ctx, next) => {\n       //Set tenant information in the request link\n       await this.tenantManager.setCurrentTenant({\n         id: '123',\n         name: 'my tenant'\n       });\n     }\n   }\n}\n")),(0,r.kt)("p",null,"Obtained in subsequent singleton services."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { TenantManager } from '@midwayjs/tenant';\nimport { Inject, Singleton } from '@midwayjs/core';\nimport { TenantInfo } from '../interface';\n\n@Singleton()\nclass TenantService {\n   @Inject()\n   tenantManager: tenant.TenantManager;\n\n   async getTenantInfo() {\n     const tenantInfo = await this.tenantManager.getCurrentTenant<TenantInfo>();\n     if (tenantInfo) {\n       console.log(tenantInfo.name);\n       // output => my tenant\n     }\n   }\n}\n")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Tenant information will definitely be associated with the request. If necessary, you can add middleware to different Frameworks."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li",start:2},(0,r.kt)("li",{parentName:"ol"},"The tenant information saved in each request is isolated"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("ol",{parentName:"li",start:3},(0,r.kt)("li",{parentName:"ol"},"Regardless of whether it is a singleton or a request scope, you can only obtain the tenant data corresponding to the current request."))))))}u.isMDXComponent=!0}}]);