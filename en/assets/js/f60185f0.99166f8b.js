"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[39015],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>k});var r=t(67294);function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function p(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){s(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,r,s=function(e,n){if(null==e)return{};var t,r,s={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(s[t]=e[t]);return s}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var l=r.createContext({}),i=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):p(p({},n),e)),t},c=function(e){var n=i(e.components);return r.createElement(l.Provider,{value:n},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,s=e.mdxType,a=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),m=i(t),d=s,k=m["".concat(l,".").concat(d)]||m[d]||u[d]||a;return t?r.createElement(k,p(p({ref:n},c),{},{components:t})):r.createElement(k,p({ref:n},c))}));function k(e,n){var t=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var a=t.length,p=new Array(a);p[0]=d;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o[m]="string"==typeof e?e:s,p[1]=o;for(var i=2;i<a;i++)p[i]=t[i];return r.createElement.apply(null,p)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},60013:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>p,default:()=>u,frontMatter:()=>a,metadata:()=>o,toc:()=>i});var r=t(87462),s=(t(67294),t(3905));const a={},p="\u6570\u636e\u54cd\u5e94",o={unversionedId:"data_response",id:"data_response",title:"\u6570\u636e\u54cd\u5e94",description:"\u4ece v3.17.0 \u5f00\u59cb\uff0c\u6846\u67b6\u6dfb\u52a0\u4e86 ServerResponse \u548c HttpServerResponse \u7684\u5b9e\u73b0\u3002",source:"@site/docs/data_response.md",sourceDirName:".",slug:"/data_response",permalink:"/en/docs/data_response",draft:!1,editUrl:"https://github.com/midwayjs/midway/tree/main/site/docs/data_response.md",tags:[],version:"current",frontMatter:{},sidebar:"common",previous:{title:"Data source management",permalink:"/en/docs/data_source"},next:{title:"Retryable",permalink:"/en/docs/retry"}},l={},i=[{value:"Http \u901a\u7528\u54cd\u5e94",id:"http-\u901a\u7528\u54cd\u5e94",level:2},{value:"\u5e38\u7528\u7684\u54cd\u5e94\u683c\u5f0f",id:"\u5e38\u7528\u7684\u54cd\u5e94\u683c\u5f0f",level:3},{value:"\u54cd\u5e94\u6a21\u7248",id:"\u54cd\u5e94\u6a21\u7248",level:3},{value:"\u6570\u636e\u6d41\u5f0f\u54cd\u5e94",id:"\u6570\u636e\u6d41\u5f0f\u54cd\u5e94",level:3},{value:"\u6587\u4ef6\u6d41\u5f0f\u54cd\u5e94",id:"\u6587\u4ef6\u6d41\u5f0f\u54cd\u5e94",level:3},{value:"SSE \u54cd\u5e94",id:"sse-\u54cd\u5e94",level:3},{value:"\u57fa\u7840\u6570\u636e\u54cd\u5e94",id:"\u57fa\u7840\u6570\u636e\u54cd\u5e94",level:2}],c={toc:i},m="wrapper";function u(e){let{components:n,...t}=e;return(0,s.kt)(m,(0,r.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"\u6570\u636e\u54cd\u5e94"},"\u6570\u636e\u54cd\u5e94"),(0,s.kt)("p",null,"\u4ece v3.17.0 \u5f00\u59cb\uff0c\u6846\u67b6\u6dfb\u52a0\u4e86 ",(0,s.kt)("inlineCode",{parentName:"p"},"ServerResponse")," \u548c ",(0,s.kt)("inlineCode",{parentName:"p"},"HttpServerResponse")," \u7684\u5b9e\u73b0\u3002"),(0,s.kt)("p",null,"\u901a\u8fc7\u8fd9\u4e2a\u529f\u80fd\uff0c\u53ef\u4ee5\u5b9a\u5236\u670d\u52a1\u7aef\u7684\u54cd\u5e94\u6210\u529f\u548c\u5931\u8d25\u65f6\u7684\u901a\u7528\u683c\u5f0f\uff0c\u89c4\u8303\u6574\u4e2a\u8fd4\u56de\u903b\u8f91\u3002"),(0,s.kt)("h2",{id:"http-\u901a\u7528\u54cd\u5e94"},"Http \u901a\u7528\u54cd\u5e94"),(0,s.kt)("p",null,"\u5728 koa \u573a\u666f\u4e0b\uff0c\u4e00\u822c\u90fd\u4f1a\u5904\u7406\u4e00\u4e9b\u903b\u8f91\uff0c\u6700\u540e\u8fd4\u56de\u4e00\u4e2a\u7ed3\u679c\u3002\u5728\u6b64\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u51fa\u73b0\u8fd4\u56de\u6210\u529f\u548c\u5931\u8d25\u7684\u60c5\u51b5\u3002"),(0,s.kt)("p",null,"\u6700\u4e3a\u5e38\u89c1\u5b9e\u73b0\u4f1a\u5728 ",(0,s.kt)("inlineCode",{parentName:"p"},"ctx")," \u589e\u52a0\u4e00\u4e9b\u65b9\u6cd5\uff0c\u5305\u62ec\u6570\u636e\u540e\u8fd4\u56de\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Controller, Get, Inject } from '@midwayjs/core';\nimport { Context } from '@midwayjs/koa';\n\n@Controller('/')\nexport class HomeController {\n  @Inject()\n  ctx: Context;\n  \n  @Get('/')\n  async home() {\n    try {\n      // ...\n      return this.ctx.ok(/*...*/);\n    } catch (err) {\n      return this.ctx.fail(/*...*/);\n    }\n  }\n}\n")),(0,s.kt)("p",null,"\u4e5f\u6709\u4eba\u4f1a\u5728 Web \u4e2d\u95f4\u4ef6\u4e2d\u5904\u7406\u6210\u529f\u7684\u8fd4\u56de\uff0c\u5728\u9519\u8bef\u8fc7\u6ee4\u5668\u4e2d\u5904\u7406\u5931\u8d25\u7684\u8fd4\u56de\u3002"),(0,s.kt)("p",null,"\u4e3a\u4e86\u89e3\u51b3\u8fd9\u7c7b\u4ee3\u7801\u96be\u4ee5\u7edf\u4e00\u7ef4\u62a4\u7684\u95ee\u9898\uff0c\u6846\u67b6\u63d0\u4f9b\u4e86\u4e00\u5957\u7edf\u4e00\u8fd4\u56de\u7684\u65b9\u6848\u3002"),(0,s.kt)("p",null,"\u6211\u4eec\u4ee5\u6700\u4e3a\u5e38\u89c1\u7684\u8fd4\u56de JSON \u6570\u636e\u4e3a\u4f8b\u3002"),(0,s.kt)("p",null,"\u901a\u8fc7\u521b\u5efa ",(0,s.kt)("inlineCode",{parentName:"p"},"HttpServerResponse")," \u5b9e\u4f8b\u540e\uff0c\u8c03\u7528 ",(0,s.kt)("inlineCode",{parentName:"p"},"json()")," \u65b9\u6cd5\uff0c\u94fe\u5f0f\u8fd4\u56de\u6570\u636e\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Controller, Get, Inject, HttpServerResponse } from '@midwayjs/core';\nimport { Context } from '@midwayjs/koa';\n\n@Controller('/')\nexport class HomeController {\n  @Inject()\n  ctx: Context;\n  \n  @Get('/success')\n  async home() {\n    return new HttpServerResponse(this.ctx).success().json({\n      // ...\n    });\n  }\n  \n  @Get('/fail')\n  async home2() {\n    return new HttpServerResponse(this.ctx).fail().json({\n      // ...\n    });\n  }\n}\n")),(0,s.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c",(0,s.kt)("inlineCode",{parentName:"p"},"HttpServerResponse")," \u5728\u6210\u529f\u548c\u5931\u8d25\u7684\u573a\u666f\u4e0a\u4f1a\u63d0\u4f9b JSON \u7684\u901a\u7528\u5305\u88f9\u7ed3\u6784\u3002"),(0,s.kt)("p",null,"\u6bd4\u5982\u5728\u6210\u529f\u7684\u573a\u666f\u4e0b\uff0c\u63a5\u6536\u5230\u7684\u6570\u636e\u5982\u4e0b\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json"},"{\n  success: 'true',\n  data: //...\n}\n")),(0,s.kt)("p",null,"\u800c\u5728\u5931\u8d25\u7684\u573a\u666f\u4e0b\uff0c\u63a5\u6536\u5230\u7684\u6570\u636e\u5982\u4e0b\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"{\n  success: 'false',\n  message: //...\n}\n")),(0,s.kt)("p",null,"\u6ce8\u610f\uff0c",(0,s.kt)("inlineCode",{parentName:"p"},"json()")," \u65b9\u6cd5\u662f\u6570\u636e\u8bbe\u7f6e\u7684\u65b9\u6cd5\uff0c\u5fc5\u987b\u5728\u6700\u540e\u4e00\u4e2a\u8c03\u7528\u3002"),(0,s.kt)("h3",{id:"\u5e38\u7528\u7684\u54cd\u5e94\u683c\u5f0f"},"\u5e38\u7528\u7684\u54cd\u5e94\u683c\u5f0f"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"HttpServerResponse")," \u9700\u8981\u4f20\u9012\u4e00\u4e2a\u5f53\u524d\u8bf7\u6c42\u7684\u4e0a\u4e0b\u6587\u5bf9\u8c61 ",(0,s.kt)("inlineCode",{parentName:"p"},"ctx")," \u624d\u80fd\u5b9e\u4f8b\u5316\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"const serverResponse = new HttpServerResponse(this.ctx);\n")),(0,s.kt)("p",null,"\u4e4b\u540e\u4ee5\u94fe\u5f0f\u7684\u5f62\u5f0f\u8fdb\u884c\u8c03\u7528\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"// json\nserverResponse.json({\n  a: 1,\n});\n// text\nserverResponse.text('abcde');\n// blob\nserverResponse.blob(Buffer.from('hello world'));\n")),(0,s.kt)("p",null,"\u9664\u4e86\u8bbe\u7f6e\u6570\u636e\u7684\u65b9\u6cd5\uff0c\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e9b\u5176\u4ed6\u7684\u5feb\u6377\u65b9\u6cd5\u53ef\u4ee5\u7ec4\u5408\u4f7f\u7528\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"// status\nserverResponse.status(200).text('abcde');\n// header\nserverResponse.header('Content-Type', 'text/html').text('<div>hello</div>');\n// headers\nserverResponse.headers({\n  'Content-Type': 'text/plain',\n  'Content-Length': '100'\n}).text('a'.repeat(100));\n\n")),(0,s.kt)("h3",{id:"\u54cd\u5e94\u6a21\u7248"},"\u54cd\u5e94\u6a21\u7248"),(0,s.kt)("p",null,"\u9488\u5bf9\u4e0d\u540c\u7684\u8bbe\u7f6e\u6570\u636e\u7684\u65b9\u6cd5\uff0c\u6846\u67b6\u63d0\u4f9b\u4e86\u4e0d\u540c\u6a21\u7248\u4ee5\u4f9b\u7528\u6237\u81ea\u5b9a\u4e49\u3002"),(0,s.kt)("p",null,"\u6bd4\u5982 ",(0,s.kt)("inlineCode",{parentName:"p"},"json()")," \u65b9\u6cd5\u7684\u6a21\u7248\u5982\u4e0b\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"class ServerResponse {\n  // ...\n  static JSON_TPL = (data: Record<any, any>, isSuccess: boolean): unknown => {\n    if (isSuccess) {\n      return {\n        success: 'true',\n        data,\n      };\n    } else {\n      return {\n        success: 'false',\n        message: data || 'fail',\n      };\n    }\n  };\n}\n")),(0,s.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u5c06\u5168\u5c40\u7684\u6a21\u7248\u8fdb\u884c\u8986\u76d6\u8fbe\u5230\u81ea\u5b9a\u4e49\u7684\u76ee\u7684\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"HttpServerResponse.JSON_TPL = (data, isSuccess) => {\n  if (isSuccess) {\n    // ...\n  } else {\n    // ...\n  }\n};\n")),(0,s.kt)("p",null,"\u4e5f\u53ef\u4ee5\u901a\u8fc7\u7ee7\u627f\uff0c\u81ea\u5b9a\u4e49\u4e0d\u540c\u7684\u54cd\u5e94\u6a21\u7248\uff0c\u8fd9\u6837\u53ef\u4ee5\u4e0d\u5f71\u54cd\u5168\u5c40\u7684\u9ed8\u8ba4\u6a21\u677f\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"class CustomServerResponse extends HttpServerResponse {}\nCustomServerResponse.JSON_TPL = (data, isSuccess) => {\n  if (isSuccess) {\n    // ...\n  } else {\n    // ...\n  }\n};\n")),(0,s.kt)("p",null,"\u5728\u4f7f\u7528\u65f6\uff0c\u521b\u5efa\u5b9e\u4f8b\u5373\u53ef\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"// ...\n\n@Controller('/')\nexport class HomeController {\n  @Inject()\n  ctx: Context;\n  \n  @Get('/')\n  async home() {\n    return new CustomServerResponse(this.ctx).success().json({\n      // ...\n    });\n  }\n}\n")),(0,s.kt)("p",null,"\u6b64\u5916\uff0c\u9488\u5bf9 ",(0,s.kt)("inlineCode",{parentName:"p"},"text")," \uff0c",(0,s.kt)("inlineCode",{parentName:"p"},"blob")," \u65b9\u6cd5\u7684\u6a21\u7248\u5747\u53ef\u4ee5\u8986\u76d6\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"HttpServerResponse.TEXT_TPL = (data, isSuccess) => { /*...*/};\nHttpServerResponse.BLOB_TPL = (data, isSuccess) => { /*...*/};\n")),(0,s.kt)("h3",{id:"\u6570\u636e\u6d41\u5f0f\u54cd\u5e94"},"\u6570\u636e\u6d41\u5f0f\u54cd\u5e94"),(0,s.kt)("p",null,"\u4f7f\u7528\u5185\u7f6e\u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"HttpServerResponse")," \u4e2d\u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"stream")," \u65b9\u6cd5\u6765\u5904\u7406\u6d41\u5f0f\u6570\u636e\u8fd4\u56de\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Controller, Get, Inject, sleep, HttpServerResponse } from '@midwayjs/core';\nimport { Context } from '@midwayjs/koa';\n\n@Controller('/')\nexport class HomeController {\n  @Inject()\n  ctx: Context;\n  \n  @Get('/')\n  async home() {\n    const res = new HttpServerResponse(this.ctx).stream();\n    setTimeout(() => {\n      for (let i = 0; i < 100; i++) {\n        await sleep(100);\n        res.send('abc'.repeat(100));\n      }\n\n      res.end();\n    }, 1000);\n    return res;\n  }\n}\n")),(0,s.kt)("p",null,"\u901a\u8fc7 ",(0,s.kt)("inlineCode",{parentName:"p"},"STEAM_TPL")," \u53ef\u4ee5\u4fee\u6539\u6570\u636e\u7684\u8fd4\u56de\u7ed3\u6784"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"HttpServerResponse.STREAM_TPL = (data) => { /*...*/};\n")),(0,s.kt)("p",null,"\u6ce8\u610f\uff0c\u8fd9\u4e2a\u6a21\u7248\u53ea\u5904\u7406\u6210\u529f\u7684\u6570\u636e\u3002"),(0,s.kt)("h3",{id:"\u6587\u4ef6\u6d41\u5f0f\u54cd\u5e94"},"\u6587\u4ef6\u6d41\u5f0f\u54cd\u5e94"),(0,s.kt)("p",null,"\u4ece v3.17.0 \u5f00\u59cb\uff0c\u53ef\u4ee5\u901a\u8fc7 ",(0,s.kt)("inlineCode",{parentName:"p"},"HttpServerResponse")," \u7b80\u5355\u5904\u7406\u6587\u4ef6\u4e0b\u8f7d\u3002"),(0,s.kt)("p",null,"\u4f20\u9012\u4e00\u4e2a\u6587\u4ef6\u8def\u5f84\u5373\u53ef\uff0c\u9ed8\u8ba4\u4f1a\u4f7f\u7528 ",(0,s.kt)("inlineCode",{parentName:"p"},"application/octet-stream")," \u54cd\u5e94\u5934\u8fd4\u56de\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Controller, Get, Inject, sleep, HttpServerResponse } from '@midwayjs/core';\nimport { Context } from '@midwayjs/koa';\n\n@Controller('/')\nexport class HomeController {\n  @Inject()\n  ctx: Context;\n  \n  @Get('/')\n  async home() {\n    const filePath = join(__dirname, '../../package.json');\n    return new HttpServerResponse(this.ctx).file(filePath);\n  }\n}\n")),(0,s.kt)("p",null,"\u5982\u9700\u8fd4\u56de\u4e0d\u540c\u7684\u7c7b\u578b\uff0c\u53ef\u4ee5\u901a\u8fc7\u7b2c\u4e8c\u4e2a\u53c2\u6570\u6307\u5b9a\u7c7b\u578b\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Controller, Get, Inject, sleep, HttpServerResponse } from '@midwayjs/core';\nimport { Context } from '@midwayjs/koa';\n\n@Controller('/')\nexport class HomeController {\n  @Inject()\n  ctx: Context;\n  \n  @Get('/')\n  async home() {\n    const filePath = join(__dirname, '../../package.json');\n    return new HttpServerResponse(this.ctx).file(filePath, 'application/json');\n  }\n}\n")),(0,s.kt)("p",null,"\u901a\u8fc7 ",(0,s.kt)("inlineCode",{parentName:"p"},"FILE_TPL")," \u53ef\u4ee5\u4fee\u6539\u8fd4\u56de\u7ed3\u6784\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"HttpServerResponse.FILE_TPL = (data: Readable, isSuccess: boolean) => { /*...*/};\n")),(0,s.kt)("h3",{id:"sse-\u54cd\u5e94"},"SSE \u54cd\u5e94"),(0,s.kt)("p",null,"\u4ece v3.17.0 \u5f00\u59cb\uff0c\u6846\u67b6\u63d0\u4f9b\u4e86\u5185\u7f6e\u7684 SSE \uff08Server-Sent Events\uff09\u652f\u6301\u3002"),(0,s.kt)("p",null,"SSE \u7684\u6570\u636e\u5b9a\u4e49\u5982\u4e0b\uff0c\u4f60\u9700\u8981\u6309\u4e0b\u9762\u7684\u683c\u5f0f\u8fd4\u56de\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"export interface ServerSendEventMessage {\n  data?: string | object;\n  event?: string;\n  id?: string;\n  retry?: number;\n}\n")),(0,s.kt)("p",null,"\u901a\u8fc7 ",(0,s.kt)("inlineCode",{parentName:"p"},"HttpServerResponse")," \u5b9a\u4e49\u4e00\u4e2a\u8fd4\u56de\u5b9e\u4f8b\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Controller, Get, Inject, sleep, HttpServerResponse } from '@midwayjs/core';\nimport { Context } from '@midwayjs/koa';\n\n@Controller('/')\nexport class HomeController {\n  @Inject()\n  ctx: Context;\n  \n  @Get('/')\n  async home() {\n    const res = new HttpServerResponse(this.ctx).sse();\n    // ...\n    return res;\n  }\n}\n")),(0,s.kt)("p",null,"\u53ef\u4ee5\u901a\u8fc7 ",(0,s.kt)("inlineCode",{parentName:"p"},"send")," \u548c ",(0,s.kt)("inlineCode",{parentName:"p"},"sendEnd")," \u8fdb\u884c\u6570\u636e\u4f20\u9012\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"const res = new HttpServerResponse(this.ctx).sse();\n\nres.send({\n  data: 'abcde'\n});\n\nres.sendEnd({\n  data: 'end'\n});\n")),(0,s.kt)("p",null,"\u8c03\u7528 ",(0,s.kt)("inlineCode",{parentName:"p"},"sendEnd")," \u540e\uff0c\u8bf7\u6c42\u5c06\u88ab\u5173\u95ed\u3002"),(0,s.kt)("p",null,"\u4e5f\u53ef\u4ee5\u901a\u8fc7 ",(0,s.kt)("inlineCode",{parentName:"p"},"sendError")," \u53d1\u9001\u9519\u8bef\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"const res = new HttpServerResponse(this.ctx).sse();\n\nres.sendError(new Error('test error'));\n")),(0,s.kt)("p",null,"\u901a\u8fc7 ",(0,s.kt)("inlineCode",{parentName:"p"},"SSE_TPL")," \u53ef\u4ee5\u4fee\u6539\u8fd4\u56de\u7ed3\u6784\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"import { ServerSendEventMessage } from '@midwayjs/core';\n\nHttpServerResponse.FILE_TPL = (data: ServerSendEventMessage) => { /*...*/};\n")),(0,s.kt)("p",null,"\u6ce8\u610f\uff0c\u8fd9\u4e2a\u6a21\u7248\u53ea\u5904\u7406\u6210\u529f\u7684\u6570\u636e\uff0c\u4e0d\u4f1a\u5904\u7406 ",(0,s.kt)("inlineCode",{parentName:"p"},"sendError")," \u7684\u60c5\u51b5\uff0c\u4e14\u8fd4\u56de\u4e5f\u5fc5\u987b\u662f ",(0,s.kt)("inlineCode",{parentName:"p"},"ServerSendEventMessage")," \u683c\u5f0f\u3002"),(0,s.kt)("h2",{id:"\u57fa\u7840\u6570\u636e\u54cd\u5e94"},"\u57fa\u7840\u6570\u636e\u54cd\u5e94"),(0,s.kt)("p",null,"\u9664\u4e86 Http \u573a\u666f\u4e4b\u5916\uff0c\u6846\u67b6\u63d0\u4f9b\u4e86\u57fa\u7840\u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"ServerResponse")," \u7c7b\uff0c\u7528\u4e8e\u5176\u4ed6\u7684\u573a\u666f\u3002"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"ServerResponse")," \u5305\u542b ",(0,s.kt)("inlineCode",{parentName:"p"},"json"),"\uff0c",(0,s.kt)("inlineCode",{parentName:"p"},"text"),"\uff0c",(0,s.kt)("inlineCode",{parentName:"p"},"blob")," \u4e09\u79cd\u6570\u636e\u8fd4\u56de\u65b9\u6cd5\uff0c\u4ee5\u53ca ",(0,s.kt)("inlineCode",{parentName:"p"},"success")," \u548c ",(0,s.kt)("inlineCode",{parentName:"p"},"fail")," \u8fd9\u4e24\u4e2a\u8bbe\u7f6e\u72b6\u6001\u7684\u65b9\u6cd5\u3002"),(0,s.kt)("p",null,"\u884c\u4e3a\u548c ",(0,s.kt)("inlineCode",{parentName:"p"},"HttpServerResponse")," \u4e00\u81f4\u3002"),(0,s.kt)("p",null,"\u901a\u8fc7\u7ee7\u627f\u3001\u8986\u76d6\u7b49\u884c\u4e3a\uff0c\u53ef\u4ee5\u975e\u5e38\u7b80\u5355\u7684\u5904\u7406\u54cd\u5e94\u503c\u3002"),(0,s.kt)("p",null,"\u6bd4\u5982\u6211\u4eec\u5bf9\u4e0d\u540c\u7684\u7528\u6237\u505a\u8fd4\u56de\u533a\u5206\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/response/api.ts\nexport class UserServerResponse extends HttpServerResponse {}\nUserServerResponse.JSON_TPL = (data, isSuccess) => {\n  if (isSuccess) {\n    return {\n      status: 200,\n      ...data,\n    };\n  } else {\n    return {\n      status: 500,\n      message: 'limit exceed'\n    };\n  }\n};\n\nexport class AdminServerResponse extends HttpServerResponse {}\nAdminServerResponse.JSON_TPL = (data, isSuccess) => {\n  if (isSuccess) {\n    return {\n      status: 200,\n      router: data.router,\n      ...data\n    };\n  } else {\n    return {\n      status: 500,\n      message: 'interal error',\n      ...data\n    };\n  }\n};\n")),(0,s.kt)("p",null,"\u4f7f\u7528\u8fd4\u56de\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Controller, Get, Inject, sleep, HttpServerResponse } from '@midwayjs/core';\nimport { Context } from '@midwayjs/koa';\nimport { UserServerResponse, AdminServerResponse } from '../response/api';\n\n@Controller('/')\nexport class HomeController {\n  @Inject()\n  ctx: Context;\n  \n  @Get('/')\n  async home() {\n    // ...\n    if (this.ctx.user === 'xxx') {\n      return new AdminServerResponse(this.ctx).json({\n        router: '/',\n        dbInfo: {\n          // ...\n        },\n        userInfo: {\n          role: 'admin',\n        },\n        status: 'ok',\n      });\n    }\n    return new UserServerResponse(this.ctx).json({\n      status: 'ok',\n    });\n  }\n}\n")))}u.isMDXComponent=!0}}]);